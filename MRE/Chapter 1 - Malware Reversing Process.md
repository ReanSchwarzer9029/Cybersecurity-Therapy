# Chapter 1 - Malware Reversing Process

## Table of Contents
```toc
```


## What is Malware?
> Short for **Malicious Software**

- Software with malicious intents to:
	- Disrupt computer operation
	- Gather sensitive information
	- Gain access to private computer systems

## Development in Malware Detection
### Malware is Named Inconsistently
- Antivirus companies use different names
- **Naming convention:** `<Malware Prefix>.<Malware Name>.<Malware Postfix>`
- **Causes of inconsistently named malware:**
	- Popular name in underground forums or used all by antivirus vendors
	- Different detection mechanisms (heuristic vs static analysis)
	- First name created by antivirus vendors persisted
	- Less prominent families are named independently by each vendor
- **Partial solutions:**
	- Use of *aliases field* (manually curated tables)
	- <u>Malheur</u>
		- Use of *automated clustering analysis*
			- Task of grouping set of objects in a way that objects in a cluster are more similar to each other than in other clusters
		- Discover possible aliases
			- Track evolution of malware family
			- Speeds up signature/remedy development
			- Speeds up construction of malware models on what the malware could do

### Antivirus Scanning
#### Signature-Based Scanning
- Efficient
- Requires frequent update of signatures
- Malware author or malware engine may mutate or encrypt the code
- Unable to detect zero-day malware

#### Heuristic-Based Analysis
- Uses **rules** to detect malicious behaviour when:
	- Program tries to copy itself
	- Program tries to remain resident after finished
	- Program decrypts itself when run
	- Program binds to TCP/IP port to listen to commands
- Uses **Trace Through Instructions** in a program before sending to the CPU
	- Includes `.COM`, `.EXE`, packets, processes and structures in memory
	- Examine changes made to the virtual environment

| Pros                                               | Cons                                                                      |
| -------------------------------------------------- | ------------------------------------------------------------------------- |
| Can be used together with a signature-based engine | More CPU resources required                                               |
| Can detect future malware                          | False positives (can be improved with weighted rules or machine learning) |

## Four Stages of Malware Analysis
- **Definition of Malware Analysis**
	- Full characterisation of malware (actions, communication channels used, resources affected)
	- How the malware can be removed or disabled
	- More time and resources needed depending on the heuristic detection
- **Difficulty Levels**
	- Fully automated analysis
	- Static properties analysis
	- Interactive behaviour analysis
	- Code reversing

### Fully Automated Analysis Stage
- Easiest but limited sight on the malware
- Commercial/Free
- Online/Toolkit
- Produce a report
	- Activities
	- Network Traffic
	- Mutex
	- Registry Keys Used
- High throughput -> large numbers of malware can be found during the incident responding process and need rapid handling
	- This allows an analyst to focus on important specimens

### Static Properties Analysis
- Examine extracted static properties
	- Embedded strings, headers, hashes, packer signatures, metadata, creation date
- Could be used for Indicators of Compromise (IoC)
- Used to prioritize efforts based on IoC

### Interactive Behaviour Analysis
- Infect an isolated lab system (sandbox) with a malware specimen
- Examine how the sample runs
- May mimic how external systems interact with the infected system
	- Study the Command and Control (C2) server
- Time consuming, more skills required

### Malware Code Reversing
- Examine characteristics impractical to examine
	- Decode encrypted data stored or transferred
	- Determine the algorithm for URL generation
	- Capabilities not exhibited
- Highly time consuming, but very meaningful insight

## Static vs Dynamic Analysis
### Malware Analysis Stages (For Analysts)
- Combined or intertwined various stages
- Uses analysis techniques to compliment each other
	- Dynamic analysis -> running the malware
	- Static analysis -> not running the malware
- Best represented by the <u>"wash, rinse and repeat"</u> until the analyst runs out of time (dynamic analysis) or malware is sufficiently analysed (static analysis) 

### Static Analysis
- <u>Static properties analysis</u>
	- Strings, hashes, file types, packer used
- <u>Static code analysis</u>
	- Understand the working of the code in byte-code/MSIL (.NET)/low-level assembly level/object code
	- Use disassemblers, debuggers and decompu